<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tableau de Bord Agent</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    .section {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 0.5rem;
      margin-right: 0.5rem;
      font-size: 1rem;
    }
    canvas {
      max-width: 100%;
    }
    .label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Tableau de Bord Agent</h1>

  <div class="section">
    <input type="email" id="email" placeholder="Votre adresse email">
    <button id="submit">Valider</button>
  </div>

  <div id="message" class="section"></div>
  <div id="prod" class="section"></div>
  <div id="rh" class="section"></div>
  <div class="section">
    <h2>Graphique Global</h2>
    <canvas id="globalChart" height="200"></canvas>
  </div>
    <!-- Script déplacé ici, juste avant la fermeture de </body> -->
  <script>

fetch("https://script.google.com/macros/s/AKfycbzm5ZGrZLCm8_-jrPJ9wpmNhIxIXvhTRa4y9nyjLz1SMMUumFSVUmufFX0yY1G6aLd1/exec?email=" + email, {
  method: 'GET',
  mode: 'no-cors', // Désactive la politique CORS
})
.then(response => response.json())
.then(data => {
  console.log(data);  // Affiche les données dans la console
  // Gère les données ici
})
.catch(error => console.error('Erreur lors de la récupération des données:', error));

  



    function renderData(data) {
      if (!data) return;

      // Message
      document.getElementById("message").innerHTML = `<h2>${data.message}</h2>`;

      // Prod
      if (data.prod) {
        const prodHTML = `
          <h3>Production</h3>
          <p><span class="label">Nb Points :</span> ${data.prod.nb_pts}</p>
          <p><span class="label">Nb Points Net :</span> ${data.prod.nb_pts_net}</p>
          <p><span class="label">Prime :</span> ${data.prod.prime}</p>
          <p><span class="label">Classement :</span> ${data.prod.classement}</p>
        `;
        document.getElementById("prod").innerHTML = prodHTML;
      }

      // RH
      if (data.rh) {
        const rhHTML = `
          <h3>RH</h3>
          <p><span class="label">Heures connexions :</span> ${data.rh.heures}</p>
          <p><span class="label">Assiduité :</span> ${data.rh.assiduite}</p>
          <p><span class="label">Congés payés :</span> ${data.rh.cp}</p>
          <p><span class="label">Tickets restos :</span> ${data.rh.tr}</p>
          <p><span class="label">Salaire :</span> ${data.rh.salaire}</p>
        `;
        document.getElementById("rh").innerHTML = rhHTML;
      }

      // Global Chart
      if (data.global) {
        const labels = data.global.map((_, i) => "Agent " + (i + 1));
        const values = data.global.map(item => item.nb_pts);
        const ctx = document.getElementById("globalChart").getContext("2d");

        new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Nb Pts",
              data: values,
              backgroundColor: "#36a2eb"
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      }
    }

    // Initial fetch (global)
    fetchData().then(renderData);

    // Button event
    document.getElementById("submit").addEventListener("click", async () => {
      const email = document.getElementById("email").value.trim();
      const data = await fetchData(email);
      renderData(data);
    });
  </script>
</body>
</html>
